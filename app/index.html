<html>
<head>
  <title>Node Boilerplate</title>
  <script src="index.js"></script>
  <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
  <!-- <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script> -->
  <link rel="manifest" href="./manifest.json"/>
  <script>
    AFRAME.registerComponent('touch-listener', {
      init: function() {
      },
      play: function() {
        const HALF_PI = Math.PI/180

        const fov = document.querySelector('a-camera').getAttribute('fov')*HALF_PI
        const height = Number(document.querySelector('a-camera').getAttribute('userHeight'))
        const scene = document.querySelector('a-scene')

        const winWidth = window.innerWidth
        const winHeight = window.innerHeight
        const winRatio = winWidth/winHeight

        const distance = 400
        const range = distance*Math.tan(fov)

        // these can be determined with fov, distance, and window dimensions
        const RANGE_X = 1
        const RANGE_Y = 3

        window.addEventListener('click', event => {
          const circle = document.createElement('a-circle')

          const camPos = document.querySelector('a-camera').getAttribute('position')
          const camTheta = document.querySelector('a-camera').getAttribute('rotation').y*HALF_PI
          const camPhi = document.querySelector('a-camera').getAttribute('rotation').x*HALF_PI

          const shiftedX = RANGE_X/(winWidth*0.5)*(event.pageX - winWidth*0.5)
          const shiftedY = RANGE_Y/(winHeight*0.5)*(winHeight*0.5 - event.pageY)

          const posX = Number(-Math.sqrt(distance)*Math.sin(camTheta)) + shiftedX || shiftedX
          const posY = Number(Math.sqrt(distance)*Math.sin(camPhi)) + height + shiftedY || height + shiftedY
          const posZ = Number(-1*Math.sqrt(distance)*Math.cos(camTheta)) || distance

          circle.setAttribute('position', {
            'x': posX,
            'y': posY,
            'z': posZ
          })

          circle.setAttribute('rotation', {
            'x': camPhi/HALF_PI,
            'y': camTheta/HALF_PI,
            'z': 0
          })

          circle.setAttribute('side', 'double')

          scene.appendChild(circle)
        })
      },
      pause: function() {

      }
    })
  </script>
</head>
  <body style='margin : 0px; overflow: hidden;'>
  	<!-- <a-scene embedded artoolkit='sourceType: webcam;'> -->
    <a-scene>
      <a-sky color="blue" touch-listener></a-sky>
  		<!-- <a-box position='0 0 0.5' material='opacity: 0.5;'></a-box> -->
  		<!-- <a-marker-camera preset='hiro'></a-marker-camera> -->
      <a-camera fov="20" userHeight="1.6"></a-camera>
  	</a-scene>
  </body>
</html>
