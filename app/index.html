<html>
<head>
  <title>Node Boilerplate</title>
  <script src="index.js"></script>
  <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
  <!-- <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script> -->
  <link rel="manifest" href="./manifest.json"/>
  <script>
    AFRAME.registerComponent('touch-listener', {
      init: function() {
      },
      play: function() {
        const HALF_PI = Math.PI/180

        const fov = document.querySelector('a-camera').getAttribute('fov')
        const height = document.querySelector('a-camera').getAttribute('userHeight')
        const scene = document.querySelector('a-scene')

        const winWidth = window.innerWidth
        const winHeight = window.innerHeight
        const winRatio = winWidth/winHeight

        const distance = 50
        const trigAngle = 0.5*fov
        const range = distance*Math.atan(trigAngle)

        const xBound = winRatio*range
        const yBound = (1/winRatio)*range

        window.addEventListener('click', event => {
          const circle = document.createElement('a-circle')

          const camPos = document.querySelector('a-camera').getAttribute('position')
          const camTheta = document.querySelector('a-camera').getAttribute('rotation').y*HALF_PI
          const camPhi = document.querySelector('a-camera').getAttribute('rotation').x*HALF_PI

          const scaledX = event.detail.x
          const scaledY = event.detail.y

          circle.setAttribute('position', {
            'x': -Math.sqrt(distance)*Math.sin(camTheta),
            'y': Math.sqrt(distance)*Math.sin(camPhi) + height,
            'z': -1*Math.sqrt(distance)*Math.cos(camTheta)
          })

          circle.setAttribute('rotation', {
            'x': camPhi/HALF_PI,
            'y': camTheta/HALF_PI,
            'z': 0
          })

          circle.setAttribute('side', 'double')
          
          scene.appendChild(circle)
        })
      },
      pause: function() {

      }
    })
  </script>
</head>
  <body style='margin : 0px; overflow: hidden;'>
  	<!-- <a-scene embedded artoolkit='sourceType: webcam;'> -->
    <a-scene>
      <a-sky color="blue" touch-listener></a-sky>
  		<!-- <a-box position='0 0 0.5' material='opacity: 0.5;'></a-box> -->
  		<!-- <a-marker-camera preset='hiro'></a-marker-camera> -->
      <a-camera fov="80" userHeight="1.6"></a-camera>
  	</a-scene>
  </body>
</html>
